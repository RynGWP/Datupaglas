<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>User Management</title>

  <!-- Google Font: Source Sans Pro -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400i,700&display=fallback">
  <!-- DataTables -->
  <link rel="stylesheet" href="/plugins/datatables-bs4/css/dataTables.bootstrap4.min.css">
  <link rel="stylesheet" href="/plugins/datatables-responsive/css/responsive.bootstrap4.min.css">
  <!-- <link rel="stylesheet" href="/plugins/datatables-buttons/css/buttons.bootstrap4.min.css"> -->
  <!-- Theme style -->
  <link rel="stylesheet" href="/dist/css/adminlte.min.css">
  <!-- SweetAlert2 -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
  <!-- Toastr -->
  <link rel="stylesheet" href="/plugins/toastr/toastr.min.css">
  <!-- BS Stepper -->
  <link rel="stylesheet" href="/plugins/bs-stepper/css/bs-stepper.min.css">
   <!-- daterange picker -->
   <link rel="stylesheet" href="/plugins/daterangepicker/daterangepicker.css">
     <!-- Tempusdominus Bootstrap 4 -->
  <link rel="stylesheet" href="/plugins/tempusdominus-bootstrap-4/css/tempusdominus-bootstrap-4.min.css">
<!-- Header styles -->
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.1/css/all.min.css">
  <link rel="stylesheet" href="style2.css">
<style>

  .btn-primary.next, .btn-secondary.previous, .btn-success.finish {
    width: 100px;
    margin:5px;
  }

  a{
    color:rgb(49, 49, 51);
  }

  .list-group-item{
    border:none;
    padding:10px 1.25rem !important;
  }
    
    .nav-icon {
      color:rgb(58, 59, 66);
    }
     
    p {
      color:rgb(119, 119, 134);
    }
    
    
    .nav-link.active{
      background-color: rgba(127, 127, 189, 0.338) !important;
    }
    
    
    .brand-link{
      border-bottom: none !important;
    }

    .modal-open {
     padding-right: 0px !important; /* Adjust based on scrollbar width */
}

td{
  color:rgba(0, 0, 0, 0.596) !important;
}

th{
  font-weight: 400 !important ;
  color:black; 
}


</style>

</head>
<body class="hold-transition sidebar-mini layout-fixed">

     <!-- preloader -->
     <%- include('../partials/preloader_v2.ejs') %>

  <div class="wrapper">
  
  
    <!-- Navbar -->
    <nav class="main-header navbar navbar-expand  navbar-light"  style="background: #e6eaea;">
      <!-- Left navbar links -->
      <ul class="navbar-nav">
        <li class="nav-item">
          <a class="nav-link text-light" data-widget="pushmenu" href="#" role="button"><i class="fas fa-bars"></i></a>
        </li>
        <!-- <li class="nav-item d-none d-sm-inline-block">
          <a href="index3.html" class="nav-link text-light">Home</a>
        </li>
        <li class="nav-item d-none d-sm-inline-block">
          <a href="#" class="nav-link">Contact</a>
        </li> -->
      </ul>
  
      <!-- Right navbar links -->
      <ul class="navbar-nav ml-auto">
        <!-- Navbar Search -->
        <!-- <button type="button" class="btn dropdown-toggle dropdown-icon text-light" data-toggle="dropdown" aria-expanded="false">
         Assessor <i class="fas fa-user"></i>
        </button> -->


         <%- include('../partials/profile.ejs') %>

         
      </ul>
    </nav>
    <!-- /.navbar -->
   
    <!-- Main Sidebar Container -->
  <aside class="main-sidebar sidebar-dark-primary elevation-4">
    <!-- Brand Logo -->
    <a href="index3.html" class="brand-link" 
    style="background-color: #ffffff;
    box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1);
  backdrop-filter: blur(4px) saturate(180%);
  -webkit-backdrop-filter: blur(2px) saturate(180%);
    ">
      <img src="/images/Seal_of_Datu_Paglas.png" alt="AdminLTE Logo" class="brand-image img-circle " style="opacity: .8">
      <small class="brand-text font-weight-bold text-dark"> DATU PAGLAS</small> 
    </a> 

    <!-- Sidebar -->
    <div class="sidebar" style="background-color: #ffffff;
    box-shadow: 0 4px 30px rgba(255, 255, 255, 0.1);
  backdrop-filter: blur(4px) saturate(180%);
  -webkit-backdrop-filter: blur(2px) saturate(180%);
    ">
      <!-- Sidebar user panel (optional) -->
  
  
  
        <!-- Sidebar Menu -->
        <nav class="mt-2">
          <ul class="nav nav-pills nav-sidebar flex-column" data-widget="treeview" role="menu" data-accordion="false">
            <!-- Add icons to the links using the .nav-icon class
                 with font-awesome or any other icon font library -->
                 <li class="nav-item " >
                  <a href="/TaxPayerDashboard" class="nav-link ">
                   
                   <i class="nav-icon"> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class=" bi bi-house" viewBox="0 0 16 16">
                    <path d="M8.707 1.5a1 1 0 0 0-1.414 0L.646 8.146a.5.5 0 0 0 .708.708L2 8.207V13.5A1.5 1.5 0 0 0 3.5 15h9a1.5 1.5 0 0 0 1.5-1.5V8.207l.646.647a.5.5 0 0 0 .708-.708L13 5.793V2.5a.5.5 0 0 0-.5-.5h-1a.5.5 0 0 0-.5.5v1.293zM13 7.207V13.5a.5.5 0 0 1-.5.5h-9a.5.5 0 0 1-.5-.5V7.207l5-5z"/>
                  </svg></i>
                    <p>
                      Dashboard   
                    </p>
                  </a>
                 
                <li class="nav-item">
                  <a href="/TaxPayerList" class="nav-link ">
                  
                  <i class="nav-icon">  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class=" bi bi-person-gear" viewBox="0 0 16 16">
                    <path d="M11 5a3 3 0 1 1-6 0 3 3 0 0 1 6 0M8 7a2 2 0 1 0 0-4 2 2 0 0 0 0 4m.256 7a4.5 4.5 0 0 1-.229-1.004H3c.001-.246.154-.986.832-1.664C4.484 10.68 5.711 10 8 10q.39 0 .74.025c.226-.341.496-.65.804-.918Q8.844 9.002 8 9c-5 0-6 3-6 4s1 1 1 1zm3.63-4.54c.18-.613 1.048-.613 1.229 0l.043.148a.64.64 0 0 0 .921.382l.136-.074c.561-.306 1.175.308.87.869l-.075.136a.64.64 0 0 0 .382.92l.149.045c.612.18.612 1.048 0 1.229l-.15.043a.64.64 0 0 0-.38.921l.074.136c.305.561-.309 1.175-.87.87l-.136-.075a.64.64 0 0 0-.92.382l-.045.149c-.18.612-1.048.612-1.229 0l-.043-.15a.64.64 0 0 0-.921-.38l-.136.074c-.561.305-1.175-.309-.87-.87l.075-.136a.64.64 0 0 0-.382-.92l-.148-.045c-.613-.18-.613-1.048 0-1.229l.148-.043a.64.64 0 0 0 .382-.921l-.074-.136c-.306-.561.308-1.175.869-.87l.136.075a.64.64 0 0 0 .92-.382zM14 12.5a1.5 1.5 0 1 0-3 0 1.5 1.5 0 0 0 3 0"/>
                  </svg></i>
                    <p>
                      User Management
                    </p>
                  </a>
                </li>
                <li class="nav-item">
                  <a href="/invoice" class="nav-link ">
                   
                  <i class="nav-icon">  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class=" bi bi-receipt-cutoff" viewBox="0 0 16 16">
                    <path d="M3 4.5a.5.5 0 0 1 .5-.5h6a.5.5 0 1 1 0 1h-6a.5.5 0 0 1-.5-.5m0 2a.5.5 0 0 1 .5-.5h6a.5.5 0 1 1 0 1h-6a.5.5 0 0 1-.5-.5m0 2a.5.5 0 0 1 .5-.5h6a.5.5 0 1 1 0 1h-6a.5.5 0 0 1-.5-.5m0 2a.5.5 0 0 1 .5-.5h6a.5.5 0 0 1 0 1h-6a.5.5 0 0 1-.5-.5m0 2a.5.5 0 0 1 .5-.5h6a.5.5 0 0 1 0 1h-6a.5.5 0 0 1-.5-.5M11.5 4a.5.5 0 0 0 0 1h1a.5.5 0 0 0 0-1zm0 2a.5.5 0 0 0 0 1h1a.5.5 0 0 0 0-1zm0 2a.5.5 0 0 0 0 1h1a.5.5 0 0 0 0-1zm0 2a.5.5 0 0 0 0 1h1a.5.5 0 0 0 0-1zm0 2a.5.5 0 0 0 0 1h1a.5.5 0 0 0 0-1z"/>
                    <path d="M2.354.646a.5.5 0 0 0-.801.13l-.5 1A.5.5 0 0 0 1 2v13H.5a.5.5 0 0 0 0 1h15a.5.5 0 0 0 0-1H15V2a.5.5 0 0 0-.053-.224l-.5-1a.5.5 0 0 0-.8-.13L13 1.293l-.646-.647a.5.5 0 0 0-.708 0L11 1.293l-.646-.647a.5.5 0 0 0-.708 0L9 1.293 8.354.646a.5.5 0 0 0-.708 0L7 1.293 6.354.646a.5.5 0 0 0-.708 0L5 1.293 4.354.646a.5.5 0 0 0-.708 0L3 1.293zm-.217 1.198.51.51a.5.5 0 0 0 .707 0L4 1.707l.646.647a.5.5 0 0 0 .708 0L6 1.707l.646.647a.5.5 0 0 0 .708 0L8 1.707l.646.647a.5.5 0 0 0 .708 0L10 1.707l.646.647a.5.5 0 0 0 .708 0L12 1.707l.646.647a.5.5 0 0 0 .708 0l.509-.51.137.274V15H2V2.118z"/>
                  </svg></i>
                    <p>
                      Invoice
                    </p>
                  </a>
                </li>
                <li class="nav-item">
                  <a href="/paymentHistory" class="nav-link ">
                  
                   <i class="nav-icon"> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class=" bi bi-cash-coin" viewBox="0 0 16 16">
                    <path fill-rule="evenodd" d="M11 15a4 4 0 1 0 0-8 4 4 0 0 0 0 8m5-4a5 5 0 1 1-10 0 5 5 0 0 1 10 0"/>
                    <path d="M9.438 11.944c.047.596.518 1.06 1.363 1.116v.44h.375v-.443c.875-.061 1.386-.529 1.386-1.207 0-.618-.39-.936-1.09-1.1l-.296-.07v-1.2c.376.043.614.248.671.532h.658c-.047-.575-.54-1.024-1.329-1.073V8.5h-.375v.45c-.747.073-1.255.522-1.255 1.158 0 .562.378.92 1.007 1.066l.248.061v1.272c-.384-.058-.639-.27-.696-.563h-.668zm1.36-1.354c-.369-.085-.569-.26-.569-.522 0-.294.216-.514.572-.578v1.1zm.432.746c.449.104.655.272.655.569 0 .339-.257.571-.709.614v-1.195z"/>
                    <path d="M1 0a1 1 0 0 0-1 1v8a1 1 0 0 0 1 1h4.083q.088-.517.258-1H3a2 2 0 0 0-2-2V3a2 2 0 0 0 2-2h10a2 2 0 0 0 2 2v3.528c.38.34.717.728 1 1.154V1a1 1 0 0 0-1-1z"/>
                    <path d="M9.998 5.083 10 5a2 2 0 1 0-3.132 1.65 6 6 0 0 1 3.13-1.567"/>
                  </svg></i>
                    <p>
                      Payment History
                    </p>
                  </a>
                </li>
          </ul>
        </nav>
        <!-- /.sidebar-menu -->
      </div>
      <!-- /.sidebar -->
    </aside>
  
    <!-- Content Wrapper. Contains page content -->
    <div class="content-wrapper">
      <!-- Content Header (Page header) -->
      <div class="content-header">
        <div class="container-fluid">
          <div class="row mb-2">
            <div class="col-sm-6">
              <h1 class="m-0"> Profile</h1>
            </div><!-- /.col -->
            <div class="col-sm-6">
              <ol class="breadcrumb float-sm-right">
                <!-- <li class="breadcrumb-item"><a href="#">Home</a></li>
                <li class="breadcrumb-item active">Dashboard v1</li> -->
              </ol>
            </div><!-- /.col -->
          </div><!-- /.row -->
        </div><!-- /.container-fluid -->
      </div>
      <!-- /.content-header -->

      <section class="content">
        <div class="container-fluid">
          <div class="row justify-content-center">
            <!-- Taxpayer Information -->
            <div class="col-md-6">
              <% if(taxPayer) { %>
              <div class="card shadow-sm border-0 rounded-lg">
                <div class="card-header text-center bg-primary text-white rounded-top">
                  <img class="profile-user-img img-fluid img-circle mb-3" src="<%= locals.taxPayer.picture %>" alt="User profile picture">
                  <h4><%= taxPayer.firstname %> <%= taxPayer.middlename %> <%= taxPayer.lastname %></h4>
                  <p class="mb-0" style="color:#e4e4ec; font-size:1rem">Tax Payer</p>
                </div>
                <div class="card-body">
                  <ul class="list-group list-group-flush">
                    <li class="list-group-item d-flex align-items-center">
                      <i class="fas fa-calendar-alt text-dark"></i> <span style="font-weight: 500 !important; margin-left: 10px !important; font-size: 1.1rem !important;">  Date of Birth</span>
                      <span class="text-muted ml-auto" style="font-weight: 400;">
                        <%= new Date(taxPayer.date_of_birth).toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' }) %>
                      </span>
                    </li>
                    <li class="list-group-item d-flex align-items-center">
                      <i class="fas fa-envelope text-dark"></i> <span style="font-weight: 500 !important; margin-left: 10px !important; font-size: 1.1rem !important;">Email</span>
                      <span class="text-muted ml-auto" style="font-weight: 400;"><%= taxPayer.email %></span>
                    </li>
                    <li class="list-group-item d-flex align-items-center">
                      <i class="fas fa-phone text-dark"></i> <span style="font-weight: 500 !important; margin-left: 10px !important; font-size: 1.1rem !important;"> Phone Number</span>
                      <span class="text-muted ml-auto" style="font-weight: 400;"><%= taxPayer.phone %></span>
                    </li>
                    <li class="list-group-item d-flex align-items-center">
                      <i class="fas fa-map-marker-alt text-dark"></i> <span style="font-weight: 500 !important; margin-left: 10px !important; font-size: 1.1rem !important;"> Address</span>
                      <span class="text-muted ml-auto" style="font-weight: 400;"><%= taxPayer.complete_address %></span>
                    </li>
                    <li class="list-group-item d-flex align-items-center">
                      <i class="fas fa-user-tag text-dark"></i> <span style="font-weight: 500 !important; margin-left: 10px !important; font-size: 1.1rem !important;"> Status</span>
                      <span class="text-muted ml-auto" style="font-weight: 400;"><%= taxPayer.status %></span>
                    </li>
                    <li class="list-group-item d-flex align-items-center">
                      <i class="fas fa-venus-mars text-dark"></i> <span style="font-weight: 500 !important; margin-left: 10px !important; font-size: 1.1rem !important;"> Gender</span>
                      <span class="text-muted ml-auto" style="font-weight: 400;"><%= taxPayer.gender %></span>
                    </li>
                  </ul>
                </div>
              </div>
              <% } %>
            </div>
      
            <!-- Additional Person and Properties Section -->
            <% if (additionalPerson || properties) { %>
            <div class="col-md-6">
              <div class="card shadow-sm border-0 rounded-lg">
                <div class="card-header text-center bg-secondary rounded-top">
                  <h5 class="mb-0 ">Additional Person</h5>
                </div>
                <div class="card-body">
                  <% if (additionalPerson) { %>
                  <ul class="list-group list-group-flush">
                    <li class="list-group-item d-flex align-items-center">
                      <i class="fas fa-user text-secondary"></i> <span style="font-weight: 500 !important; margin-left: 10px !important; font-size: 1.1rem !important;"> Full Name</span>
                      <span class="text-muted ml-auto" style="font-weight: 400;">
                        <%= additionalPerson.firstname %> <%= additionalPerson.middlename %> <%= additionalPerson.lastname %>
                      </span>
                    </li>
                    <li class="list-group-item d-flex align-items-center">
                      <i class="fas fa-envelope text-secondary"></i> <span style="font-weight: 500 !important; margin-left: 10px !important; font-size: 1.1rem !important;"> Email</span>
                      <span class="text-muted ml-auto" style="font-weight: 400;"><%= additionalPerson.email %></span>
                    </li>
                    <li class="list-group-item d-flex align-items-center">
                      <i class="fas fa-phone text-secondary"></i> <span style="font-weight: 500 !important; margin-left: 10px !important; font-size: 1.1rem !important;"> Phone</span>
                      <span class="text-muted ml-auto" style="font-weight: 400;"><%= additionalPerson.phone %></span>
                    </li>
                    <li class="list-group-item d-flex align-items-center">
                      <i class="fas fa-map-marker-alt text-secondary"></i> <span style="font-weight: 500 !important; margin-left: 10px !important; font-size: 1.1rem !important;"> Address</span>
                      <span class="text-muted ml-auto" style="font-weight: 400;"><%= additionalPerson.complete_address %></span>
                    </li>
                    <li class="list-group-item d-flex align-items-center">
                      <i class="fas fa-user-friends text-secondary"></i> <span style="font-weight: 500 !important; margin-left: 10px !important; font-size: 1.1rem !important;"> Relationship</span>
                      <span class="text-muted ml-auto" style="font-weight: 400;"><%= additionalPerson.relationship %></span>
                    </li>
                  </ul>
                  <% } %>
                </div>
                
              <% } %>
          </div>
        </div>

        </div>

      
          <!-- property row -->
          <div class="row mt-5">
            <div class="col-lg-12">
              <div class="card">
                <div class="card-header">
                  <h3 class="card-title">Property Information</h3>
                  <div class="row d-flex justify-content-end">
                    <div class="col-4 d-flex justify-content-end ">
                      
                      <!-- <button class="btn " id="addPropertyButton" data-toggle="modal" data-target="#addPropertyModal" style="background: transparent; border: none; color:green" data-taxpayer_id = "<%= taxPayer.taxpayer_id %>">
                        <i class="fas fa-add"></i>
                      </button> -->
      
  
                    </div> 
               
              </div>
                </div>
                <div class="card-body">
                  <% if (locals.properties) { %>
                    <table id="propertyTable" class="table table-bordered ">
                      <thead>
                        <tr>
                          <th>Property ID</th>
                          <th>Property Location</th>
                          <th>Property Type</th>
                          <th>Area </th>       
                          <th>Assessment Rate</th>
                          <th>Classification</th>
                          <th>Invoice</th>
                          <th>Status</th>
                          <th>Action</th>
      
                        </tr>
                      </thead>
                      <tbody>
                        <% properties.forEach(property => { %>
                          <tr>
                            <td class="text-center"><%= property.property_id %></td>
                            <td><%= property.property_location %></td>
                            <td><%= property.property_type %></td>
                            <td><%= property.area %> sq. m.</td>
                           
                            <td><%= property.assessment_rate %>%</td>
                            <td><%= property.classification %></td>
                            <td><span class="badge badge-<%= property.invoice === 'pending' ? 'danger' : 'success' %>"><%= property.invoice%></span></td>
                            <td>
                              <span class="badge badge-<%= property.occupancy_status === 'Occupied' ? 'success' : 'info' %>">
                                <%= property.occupancy_status %>
                              </span>
                            </td>
                            <!-- action -->
                       
                            <td class="d-flex align-items-center justify-content-center">     
                              <button type="button" class="btn viewPropertyButton" 
                              data-toggle="modal" 
                              data-target="#viewPropertyModal"
                              data-property-id="<%= property.property_id %>"
                              data-taxpayer-id="<%= property.taxpayer_id %>"
                              data-property-type="<%= property.property_type %>"
                              data-tax-declaration="<%= property.tax_declaration %>"
                              data-property-index="<%= property.property_index %>"
                              data-certificate-title="<%= property.certificate_title %>"
                              data-cadastral-lot="<%= property.cadastral_lot %>"
                              data-lot-no="<%= property.lot_no %>"
                              data-block-no="<%= property.block_no %>"
                              data-kind="<%= property.kind %>"
                              data-unit-value="<%= property.unit_value %>"
                              data-adjustment="<%= property.adjustment %>"
                              data-assessment-rate="<%= property.assessment_rate %>"
                              data-north="<%= property.north %>"
                              data-south="<%= property.south %>"
                              data-east="<%= property.east %>"
                              data-west="<%= property.west %>"
                              data-last-assessment-date="<%= property.last_assessment_date.toISOString() %>"
                              data-next-assessment-date="<%= property.next_assessment_date.toISOString() %>"
                              data-market-value="<%= property.market_value %>"
                              data-ownership-type="<%= property.ownership_type %>"
                              data-property-location="<%= property.property_location %>"
                              data-property-use="<%= property.property_use %>"
                              data-occupancy-status="<%= property.occupancy_status %>"
                              data-classification="<%= property.classification %>"
                              data-area="<%= property.area %>"
                              style="background: transparent; border: none; color: blue;">
                              <i class="fa-regular fa-lg fa-eye"> </i>
                      </button>

                      <button type="button" class="btn calculatorButton" 
                                          data-toggle="modal" 
                                          data-target="#Modal"
                                          data-taxpayer-firstname= "<%= taxPayer.firstname %>"
                                          data-taxpayer-lastname= "<%= taxPayer.lastname %>"
                                          data-property-id="<%= property.property_id %>"
                                          data-taxpayer-id="<%= property.taxpayer_id %>"
                                          data-property-type="<%= property.property_type %>"
                                         
                                          data-property-use="<%= property.property_use %>"
                                          data-occupancy-status="<%= property.occupancy_status %>"
                                          data-classification="<%= property.classification %>"
                                          data-area="<%= property.area %>"
                                          style="background: transparent; border: none; color: blue;">
                                          <svg xmlns="http://www.w3.org/2000/svg" height="20" width="15" viewBox="0 0 384 512"><!--!Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2024 Fonticons, Inc.--><path fill="#63E6BE" d="M64 0C28.7 0 0 28.7 0 64L0 448c0 35.3 28.7 64 64 64l256 0c35.3 0 64-28.7 64-64l0-384c0-35.3-28.7-64-64-64L64 0zM96 64l192 0c17.7 0 32 14.3 32 32l0 32c0 17.7-14.3 32-32 32L96 160c-17.7 0-32-14.3-32-32l0-32c0-17.7 14.3-32 32-32zm32 160a32 32 0 1 1 -64 0 32 32 0 1 1 64 0zM96 352a32 32 0 1 1 0-64 32 32 0 1 1 0 64zM64 416c0-17.7 14.3-32 32-32l96 0c17.7 0 32 14.3 32 32s-14.3 32-32 32l-96 0c-17.7 0-32-14.3-32-32zM192 256a32 32 0 1 1 0-64 32 32 0 1 1 0 64zm32 64a32 32 0 1 1 -64 0 32 32 0 1 1 64 0zm64-64a32 32 0 1 1 0-64 32 32 0 1 1 0 64zm32 64a32 32 0 1 1 -64 0 32 32 0 1 1 64 0zM288 448a32 32 0 1 1 0-64 32 32 0 1 1 0 64z"/></svg>
                                  </button>
                                  
                            </td>
                           <!-- / action -->
                          </tr>
                        <% }) %>
                      </tbody>
                    </table>
                  <% } else { %>
                    <div class="alert alert-info">
                      No properties found for this taxpayer.
                    </div>
                  <% } %>
                </div>
              </div>
            </div>
        </div>
          <!-- / property row -->






              <!-- statement row -->
              <div class="row mt-5">
                <div class="col-lg-12">
                  <div class="card">
                    <div class="card-header">
                      <h3 class="card-title">Statement of Account</h3>
                      <div class="row d-flex justify-content-end">
                        <div class="col-4 d-flex justify-content-end ">
                          
                          <!-- <button class="btn " id="addPropertyButton" data-toggle="modal" data-target="#addPropertyModal" style="background: transparent; border: none; color:green" data-taxpayer_id = "<%= taxPayer.taxpayer_id %>">
                            <i class="fas fa-add"></i>
                          </button> -->
          
      
                        </div> 
                   
                  </div>
                    </div>
                    <div class="card-body">
                      <table id="statementOfAccountTable" class="table  ">
                        <thead>
      
                          
                          <tr>
                            <th>Property ID</th>
                            <th>Full name</th>
                            <th>Assessment level</th>
                            <th>Assessed value</th>
                            <th>Property type</th>
                            <th>assessment Rate</th>
                            <th>Total tax amount</th>
                            <th>Due date</th>
                            <th>Payment Status</th>
                           
                          </tr>
                        </thead>
                        
                        <tbody>
                            <% if(locals.statementOfAccounts) { %>
                              <% statementOfAccounts.forEach(function(statementOfAccount) { %>
      
                            <tr>
                              <td><%= statementOfAccount.property_id %></td>
                              <td><%= statementOfAccount.firstname%> <%= statementOfAccount.lastname%></td>
                              <td><%= statementOfAccount.assessment_level%></td>
                              <td><%= statementOfAccount.assessed_value%></td>         
                              <td><%= statementOfAccount.property_type%></td>
                              <td><%= statementOfAccount.tax_rate%></td>         
                              <td class="text-info"><%= statementOfAccount.total_tax_amount%></td>   
                              <td class="text-danger"><%= new Date(statementOfAccount.due_date).toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' }) %></td>       
                              <td><span class="badge badge-<%= statementOfAccount.status ==='pending' ? 'warning' : 'success' %>"> <%= statementOfAccount.status %></span></td>
                              
                            <!-- /Action -->
                          </tr>
      
                          <% }) %>
                          <% } %>
                       
                        </tbody>
                      </table>
                    </div>
                  </div>
                </div>
            
              <!-- / statement row -->
      </section>


      

      
      
  </div>
  <!-- /.content-wrapper -->
  <footer class="main-footer">
    <div class="float-right d-none d-sm-block">
      <b>Version</b> 3.2.0
    </div>
    <strong>Copyright &copy; 2014-2021 <a href="https://adminlte.io">AdminLTE.io</a>.</strong> All rights reserved.
  </footer>

  <!-- Control Sidebar -->
  <aside class="control-sidebar control-sidebar-dark">
    <!-- Control sidebar content goes here -->
  </aside>
  <!-- /.control-sidebar -->
</div>
<!-- ./wrapper -->


<div class="modal fade" id="Modal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-md">
    <div class="modal-content rounded-4 shadow-lg">
      <div class="modal-header">
        <h4 class="modal-title">Property Tax Calculator</h4>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>

      <div class="modal-body p-3" style="background-color:rgba(255, 255, 255, 0.792);
      box-shadow: 0 4px 30px rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(4px) saturate(180%);
      -webkit-backdrop-filter: blur(2px) saturate(180%);
      border: 1px solid rgba(254, 254, 254, 0.3);">
       
        <form id="taxForm" action="/insertInvoice" method="post">
          <input type="hidden" id="fname" name="firstname">
          <input type="hidden" id="lname" name="lastname">
          <input type="hidden" name="taxpayer_id" id="taxpayer_id">
          <input type="hidden" id="area" name="area">
          <input type="hidden" id="property_use" name="property_use">
          <input type="hidden" id="property_id" name="property_id">
          <input type="hidden" name="invoice" value="created">
          <input type="hidden" name="classification" id="classification" >
          
            <div class="col-lg-12">
              <div class="form-group">
                <label for="gender" class="form-label ">Property Type</label>
                <select class="custom-select" id="property_type" name="property_type" required >
                  <option value="">Select Property Type</option>
                            <option value="Residential">Residential</option>
                            <option value="Commercial">Commercial</option>
                            <option value="Industrial">Industrial</option>
                            <option value="Mineral">Mineral</option>
                            <option value="Agricultural">Agricultural</option>
                            <option value="Timberland">Timberland</option>
                </select>
              </div>
            </div>

          <div class="form-group">
            <div class="col-md-12">
              <label for="assessmentLevel" class="form-label " >Assessment Level (%)</label>
              <input type="number"  id="assessmentLevel" placeholder="Enter Assessment Level (%)" class="form-control" required name="assessment_level" >
            </div>
          </div>
    
      
          <div class="form-group">
            <div class="col-md-12">
              <label for="marketValue" class="form-label ">Market Value (₱)</label>
              <input type="number" id="marketValue" placeholder="Enter Market Value" class="form-control" required name="market_value" >
            </div>
          </div>

          <div class="form-group">
            <div class="col-md-12">
              <label for="taxRate" class="form-label ">Tax Rate (%)</label>
              <input type="number" id="tax_rate" placeholder="Enter Tax Rate" class="form-control" required name="tax_rate" >
            </div>
 
          </div>

     
          <div class="form-group">
            <div class="col-12">
              <label for="assessedValue" class="form-label ">Total Assessed Value</label>
              <input type="number" id="assessedValue" value="0.00" class="form-control  fs-5 "  style="font-weight: bold; color:#2b832b;" name="assessed_value">
            </div>
     
          </div>

       
          <div class="form-group mb-0">
            <div class="col-12">
              <label for="taxAmount" class="form-label ">Total Tax Amount</label>
              <input type="text" id="taxAmount" value="0.00" class="form-control  fs-5 "  style="font-weight: bold; color:#2b832b;" name="total_tax_amount">
            </div>
          </div>
     

          <!-- <div class="text-center">
            <button type="button" class="btn btn-primary w-100 py-2" onclick="calculateTax()">Calculate</button>
          </div> -->
      
      </div>

      <div class="modal-footer" >
        <button type="submit" class="btn btn-primary w-100">Insert Tax Amount</button>
      </div>
    </form>
    </div>
  </div>
</div>




<!-- view property modal -->
<div class="modal fade" id="viewPropertyModal" tabindex="-1" role="dialog" aria-labelledby="viewPropertyModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header bg-primary text-white">
        <h5 class="modal-title" id="viewPropertyModalLabel">View Property Details</h5>
        <button type="button" class="close text-white" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body p-3">
        <div class="row">
          <!-- Property Type -->
          <div class="col-md-6 mb-3">
            <p><strong>Property Type:</strong> <span id="propertyTypeView"></span></p>
          </div>
          <!-- Tax Declaration -->
          <div class="col-md-6 mb-3">
            <p><strong>Tax Declaration:</strong> <span id="taxDeclarationView"></span></p>
          </div>
        </div>
        <div class="row">
          <!-- Property Index -->
          <div class="col-md-6 mb-3">
            <p><strong>Property Index:</strong> <span id="propertyIndexView"></span></p>
          </div>
          <!-- Certificate Title -->
          <div class="col-md-6 mb-3">
            <p><strong>Certificate Title:</strong> <span id="certificateTitleView"></span></p>
          </div>
        </div>
        <div class="row">
          <!-- Cadastral Lot -->
          <div class="col-md-6 mb-3">
            <p><strong>Cadastral Lot:</strong> <span id="cadastralLotView"></span></p>
          </div>
          <!-- Lot No -->
          <div class="col-md-6 mb-3">
            <p><strong>Lot No:</strong> <span id="lotNoView"></span></p>
          </div>
        </div>
        <div class="row">
          <!-- Block No -->
          <div class="col-md-6 mb-3">
            <p><strong>Block No:</strong> <span id="blockNoView"></span></p>
          </div>
          <!-- Kind -->
          <div class="col-md-6 mb-3">
            <p><strong>Kind:</strong> <span id="kindView"></span></p>
          </div>
        </div>
        <div class="row">
          <!-- Unit Value -->
          <div class="col-md-6 mb-3">
            <p><strong>Unit Value:</strong> <span id="unitValueView"></span></p>
          </div>
          <!-- Adjustment -->
          <div class="col-md-6 mb-3">
            <p><strong>Adjustment:</strong> <span id="adjustmentView"></span></p>
          </div>
        </div>
        <div class="row">
          <!-- Assessment Rate -->
          <div class="col-md-6 mb-3">
            <p><strong>Assessment Rate:</strong> <span id="assessmentRateView"></span></p>
          </div>
          <!-- Market Value -->
          <div class="col-md-6 mb-3">
            <p><strong>Market Value:</strong> <span id="marketValueView"></span></p>
          </div>
        </div>
        <div class="row">
          <!-- Ownership Type -->
          <div class="col-md-6 mb-3">
            <p><strong>Ownership Type:</strong> <span id="ownershipTypeView"></span></p>
          </div>
          <!-- Property Location -->
          <div class="col-md-6 mb-3">
            <p><strong>Property Location:</strong> <span id="propertyLocationView"></span></p>
          </div>
        </div>
        <div class="row">
          <!-- Property Use -->
          <div class="col-md-6 mb-3">
            <p><strong>Property Use:</strong> <span id="propertyUseView"></span></p>
          </div>
          <!-- Occupancy Status -->
          <div class="col-md-6 mb-3">
            <p><strong>Occupancy Status:</strong> <span id="occupancyStatusView"></span></p>
          </div>
        </div>
        <div class="row">
          <!-- Classification -->
          <div class="col-md-6 mb-3">
            <p><strong>Classification:</strong> <span id="classificationView"></span></p>
          </div>
          <!-- Area -->
          <div class="col-md-6 mb-3">
            <p><strong>Area:</strong> <span id="areaView"></span></p>
          </div>
        </div>
        <div class="row">
          <!-- Directions -->
          <div class="col-md-3 mb-3">
            <p><strong>North:</strong> <span id="northView"></span></p>
          </div>
          <div class="col-md-3 mb-3">
            <p><strong>South:</strong> <span id="southView"></span></p>
          </div>
          <div class="col-md-3 mb-3">
            <p><strong>East:</strong> <span id="eastView"></span></p>
          </div>
          <div class="col-md-3 mb-3">
            <p><strong>West:</strong> <span id="westView"></span></p>
          </div>
        </div>
        <div class="row">
          <!-- Dates -->
          <div class="col-md-6 mb-3">
            <p><strong>Last Assessment Date:</strong> <span id="lastAssessmentDateView"></span></p>
          </div>
          <div class="col-md-6 mb-3">
            <p><strong>Next Assessment Date:</strong> <span id="nextAssessmentDateView"></span></p>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>
<!-- / view property modal -->


<script src="/plugins/jquery/jquery.min.js"></script>
<script src="/plugins/bootstrap/js/bootstrap.bundle.min.js"></script>
<script src="/plugins/datatables/jquery.dataTables.min.js"></script>
<script src="/plugins/datatables-bs4/js/dataTables.bootstrap4.min.js"></script>
<script src="/plugins/datatables-responsive/js/dataTables.responsive.min.js"></script>
<script src="/plugins/datatables-responsive/js/responsive.bootstrap4.min.js"></script>
<!-- <script src="/plugins/datatables-buttons/js/dataTables.buttons.min.js"></script>
<script src="/plugins/datatables-buttons/js/buttons.bootstrap4.min.js"></script> -->
<!-- <script src="/plugins/jszip/jszip.min.js"></script>
<script src="/plugins/pdfmake/pdfmake.min.js"></script>
<script src="/plugins/pdfmake/vfs_fonts.js"></script>
<script src="/plugins/datatables-buttons/js/buttons.html5.min.js"></script>
<script src="/plugins/datatables-buttons/js/buttons.print.min.js"></script> -->
<!-- <script src="/plugins/datatables-buttons/js/buttons.colVis.min.js"></script> -->
<script src="/dist/js/adminlte.min.js"></script>
<script src="/plugins/bs-stepper/js/bs-stepper.min.js"></script>
<!-- <script src="/plugins/dropzone/min/dropzone.min.js"></script> -->
<script src="/plugins/moment/moment.min.js"></script>
<!-- Tempusdominus Bootstrap 4 -->
<script src="/plugins/tempusdominus-bootstrap-4/js/tempusdominus-bootstrap-4.min.js"></script>

<!-- Toastr -->
<script src="/plugins/toastr/toastr.min.js"></script>



<script>
  $(function() {
    var Toast = Swal.mixin({
      toast: true,
      position: 'top-end',
      showConfirmButton: false,
      timer: 3000,
      timerProgressBar:true
    });

    $('.finish').click(function() {
      Toast.fire({
        icon: 'success',
        title: ' Registered Successfully'
      })
    });
   
    $('.swalDefaultError').click(function() {
      Toast.fire({
        icon: 'error',
        title: 'Lorem ipsum dolor sit amet, consetetur sadipscing elitr.'
      })
    });
   

        $('#dateOfBirth').datetimepicker({
            format: 'L'
        });
        $('#lastAssessmentDate').datetimepicker({
            format: 'L'
        });
        $('#nextAssessmentDate').datetimepicker({
            format: 'L'
        });

  })
</script>




<!-- properties script  -->
<script>
  document.addEventListener('DOMContentLoaded', () => {
    const editButtons = document.querySelectorAll('.calculatorButton');
    const modal = document.querySelector('#Modal');

    editButtons.forEach(button => {
      button.addEventListener('click', () => {
        const taxpayerId = button.dataset.taxpayerId;
        const propertyId = button.dataset.propertyId;
        const taxpayerFirstName = button.dataset.taxpayerFirstname; 
        const taxpayerLastName = button.dataset.taxpayerLastname; 
        const taxpayerPropertyType = button.dataset.propertyType;  
        const propertyUse = button.dataset.propertyUse;        
        const area = button.dataset.area;      
        const classification = button.dataset.classification;

        document.getElementById('fname').value = taxpayerFirstName;
        document.getElementById('lname').value = taxpayerLastName;
        document.getElementById('taxpayer_id').value = taxpayerId;
        document.getElementById('property_id').value = propertyId;
        document.getElementById('property_type').value = taxpayerPropertyType;
        document.getElementById('property_use').value = propertyUse;
        document.getElementById('area').value = area;
        document.getElementById('classification').value = classification;

       
      });   
    }); 
  });
</script>

<!-- for property -->




<!-- for view -->
<script>
  document.addEventListener('DOMContentLoaded', () => {
    const viewPropertyButtons = document.querySelectorAll('.viewPropertyButton');
  
    viewPropertyButtons.forEach(button => {
      button.addEventListener('click', function() {
        const dataset = this.dataset;
  
        // Populate modal fields
        document.getElementById('propertyTypeView').textContent = dataset.propertyType;
        document.getElementById('taxDeclarationView').textContent = dataset.taxDeclaration;
        document.getElementById('propertyIndexView').textContent = dataset.propertyIndex;
        document.getElementById('certificateTitleView').textContent = dataset.certificateTitle;
        document.getElementById('cadastralLotView').textContent = dataset.cadastralLot;
        document.getElementById('lotNoView').textContent = dataset.lotNo;
        document.getElementById('blockNoView').textContent = dataset.blockNo;
        document.getElementById('kindView').textContent = dataset.kind;
        document.getElementById('unitValueView').textContent = dataset.unitValue;
        document.getElementById('adjustmentView').textContent = dataset.adjustment;
        document.getElementById('assessmentRateView').textContent = dataset.assessmentRate;
        document.getElementById('marketValueView').textContent = dataset.marketValue;
        document.getElementById('ownershipTypeView').textContent = dataset.ownershipType;
        document.getElementById('propertyLocationView').textContent = dataset.propertyLocation;
        document.getElementById('propertyUseView').textContent = dataset.propertyUse;
        document.getElementById('occupancyStatusView').textContent = dataset.occupancyStatus;
        document.getElementById('classificationView').textContent = dataset.classification;
        document.getElementById('areaView').textContent = dataset.area;
        document.getElementById('northView').textContent = dataset.north;
        document.getElementById('southView').textContent = dataset.south;
        document.getElementById('eastView').textContent = dataset.east;
        document.getElementById('westView').textContent = dataset.west;
  
        // Format and set date fields
        document.getElementById('lastAssessmentDateView').textContent = new Date(dataset.lastAssessmentDate).toLocaleDateString();
        document.getElementById('nextAssessmentDateView').textContent = new Date(dataset.nextAssessmentDate).toLocaleDateString();
      });
    });
  });
  </script>

  <!-- for property -->

<script>

document.addEventListener('DOMContentLoaded', () => {
  // Add event listeners to input fields
  const assessmentLevelInput = document.getElementById("assessmentLevel");
  const marketValueInput = document.getElementById("marketValue");
  const taxRateInput = document.getElementById("tax_rate");

  // Function to calculate tax
  function calculateTax() {
    // Get values from the input fields
    const assessmentLevel = parseFloat(assessmentLevelInput.value);
    const marketValue = parseFloat(marketValueInput.value);
    const taxRate = parseFloat(taxRateInput.value);
    const zero = 0;

// Validate input values
if (isNaN(marketValue) || isNaN(assessmentLevel) || isNaN(taxRate)) {
  // Clear calculated values if any input is invalid
  document.getElementById("assessedValue").value = zero.toFixed(2);
  document.getElementById("taxAmount").value = zero.toFixed(2);
  return;
}

    // Calculate assessed value
    const assessedValue = marketValue * (assessmentLevel / 100);

    // Calculate tax amount
    const taxAmount = assessedValue * (taxRate / 100);

    // Display the results
    // Assuming assessedValue and taxAmount are calculated values
document.getElementById("assessedValue").value = parseFloat(assessedValue);

document.getElementById("taxAmount").value = parseFloat(taxAmount).toLocaleString('en-US', {
  minimumFractionDigits: 2,
  maximumFractionDigits: 2,
});
  }

  // Add event listeners to trigger calculation on input
  assessmentLevelInput.addEventListener('input', calculateTax);
  marketValueInput.addEventListener('input', calculateTax);
  taxRateInput.addEventListener('input', calculateTax);
});

</script>

<script>
  const btnSuccess = document.querySelector('.btn-success');
  const taxForm = document.querySelector('#taxForm'); // Select the form element

  btnSuccess.addEventListener('click', function (event) {
      event.preventDefault(); // Prevent default form submission

      Swal.fire({
          title: 'Confirmation',
          text: "Are you sure to insert  this tax amount?",
          icon: 'warning',
          showCancelButton: true,
          confirmButtonText: "Yes",
          confirmButtonColor: "#12be12c1",
          cancelButtonText: "Cancel",
          cancelButtonColor: "#FF0000",
          customClass: {
              popup: 'glassmorphism-popup'
          }
      }).then((result) => {
          if (result.isConfirmed) {
              // Submit the form if confirmed
              taxForm.submit();
          }
      });
  });
</script>

<!-- properties script  -->

<!-- datatables initialization -->
<script>
// Make sure this code is inside a script tag and after loading all required DataTables libraries
$(document).ready(function() {
    // Initialize Property Table
    $('#propertyTable').DataTable({
        "paging": true,
        "lengthChange": true,
        "searching": true,
        "ordering": true,
        "info": true,
        "autoWidth": false,
        "responsive": true
    });

    // Initialize Statement of Account Table
    $('#statementOfAccountTable').DataTable({
        "paging": true,
        "lengthChange": true,
        "searching": true,
        "ordering": true,
        "info": true,
        "autoWidth": false,
        "responsive": true
    });
});
</script>




<!-- SweetAlert2 -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<script src="/userManagementScript.js"></script>
<script src="/preloader.js"></script>
</body>
</html>


