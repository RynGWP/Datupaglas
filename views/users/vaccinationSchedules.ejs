<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Home Page</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous"/>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&display=swap">
    <link rel="stylesheet" href="style.css">



    <style>
      .input {
   
    text-align: center; /* Center the text in the input */
}

.input::placeholder {
    text-align: center; /* Center the placeholder text */
    margin-left: 0; /* Remove any default margin */
}

/* Optional: Style the input field */
.input {
    border: 1px solid #ccc; /* Border for better visibility */
    border-radius: 4px; /* Rounded corners */
    width: 100%; /* Full width */
    height: 40px; /* Adjust height as needed */
}

    </style>
</head>

<body>
    
    <!-- Main Container -->
    <div class="container-fluid p-0"> <!-- Remove padding to prevent any gaps -->
        <%- include("../partials/userNav.ejs") %>
      
    
          <div class="row m-0  flex-nowrap ">
              <!-- Sidebar Column -->
              <div class="col-12 col-md-3 col-lg-2 p-2 col-sm-3 bg-light collapse sidebar" id="sidebar">
                  <%- include("../partials/sidebar.ejs") %>
              </div>
    
            
    
              <!-- Main Content Column -->
              <div class="col-12 col-md-9 col-lg-10 p-0 main-content">
                  <div class="container p-2">
                      <span class="date d-block p-2 mx-2 my-2 mb-3 d-flex justify-content-between text-md-start">
                          <p class="text-dark fw-lighter fs-4 d-flex flex-start myPatients">Vaccination Schedules</p>
                          <p class="text-dark fw-lighter fs-4 d-flex flex-start myPatientsDate"> <%= new Date().toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' }) %></p>
                      </span>
    

     
            <div class="col-lg-12 col-sm-12 mb-5 ">
                <div class="table-responsive p-2" style="border: 1px white; box-shadow: rgba(209, 209, 209, 0.156) 0 0 0 1px;">
                    <table class="table table-hover" id="vaccinationTable">
                                    <!-- Search Input -->
                          <div class="float-end mb-3">
                            <div class="col-lg-12 col-sm-4">
                                <div class="input-group">
                                    <input type="text" id="searchInput" class="form-control" placeholder="Search Patient" aria-label="Search Patient" aria-describedby="basic-addon1" onkeyup="filterTable()">
                                    <span class="input-group-text" id="basic-addon1">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-search" viewBox="0 0 16 16">
                                            <path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001q.044.06.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1 1 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0"/>
                                        </svg>
                                    </span>
                                </div>
                            </div>
                        </div>
                      
                      
                        <thead>
                            <tr>
                                <th class="vaccinationThid">Schedule Id</th>
                                <th class="vaccinationThShowtoMobile">Full Name</th>
                                <th class="vaccinationTh">Schedule date</th>
                                <th class="vaccinationThShowtoMobile">Vaccine</th>
                                <th class="vaccinationTh">Status</th>
                                <th class="vaccinationThShowtoMobile">Action</th>
                            </tr>
                        </thead>
                        <tbody>
                            <% if (locals.vaccinationSchedules) { %>
                                <% 
                                // Object to track the names that have been displayed
                                const displayedNames = {};
                                vaccinationSchedules.forEach(function(vaccinationSchedule, index) {
                                    const fullName = vaccinationSchedule.full_name;
                                    const isFirstOccurrence = !displayedNames[fullName]; // check if the Fullname has been seen before, 
                                                                                         // if not, set the Fullname to true
                        
                                    // Set the name as displayed
                                    displayedNames[fullName] = true;
                                    
                                    // Check if the next schedule is for a different patient
                                    const nextSchedule = vaccinationSchedules[index + 1];
                                    const isLastScheduleForPatient = !nextSchedule || nextSchedule.full_name !== fullName;
                                %>
                                    <tr>
                                        <td class="vaccinationTdid"><%= vaccinationSchedule.schedule_id %></td>
                                        <td class="vaccinationTdShowtoMobile ">
                                          <% if (isFirstOccurrence) { %>
                                              <form action="/allVaccinationStatus" method="POST" id="vaccinationStatusForm" class="d-inline-block ms-2">
                                                  <button type="submit" class="btn btn-success btn-sm text-light editStatusButton" value="<%= vaccinationSchedule.patient_id %>" name="patientId">
                                                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-calendar-week" viewBox="0 0 16 16">
                                                      <path d="M11 6.5a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5zm-3 0a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5zM3.5 9.5a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5z"/>
                                                      <path d="M3.5 0a.5.5 0 0 1 .5.5V1h8V.5a.5.5 0 0 1 1 0V1h1a2 2 0 0 1 2 2v11a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V3a2 2 0 0 1 2-2h1V.5a.5.5 0 0 1 .5-.5zM1 4v10a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1V4z"/>
                                                  </svg>
                                                 
                                                  </button>
                                              </form>
                                          <% } %>
                                          <%= isFirstOccurrence ? fullName : '' %> 
                                    </td>

                                        <td class="vaccinationTd"><%= new Date(vaccinationSchedule.schedule_date).toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' }) %>
                                            <button type="button" class="btn btn-sm me-5 text-light editSchedule" aria-label="EditSchedule">
                                                        <!-- Re-sched -->
                                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="blue" class="bi bi-pencil-square me-1" viewBox="0 0 16 16">
                                                <path d="M15.502 1.94a.5.5 0 0 1 0 .706L14.459 3.69l-2-2L13.502.646a.5.5 0 0 1 .707 0l1.293 1.293zm-1.75 2.456-2-2L4.939 9.21a.5.5 0 0 0-.121.196l-.805 2.414a.25.25 0 0 0 .316.316l2.414-.805a.5.5 0 0 0 .196-.12l6.813-6.814z"/>
                                                <path fill-rule="evenodd" d="M1 13.5A1.5 1.5 0 0 0 2.5 15h11a1.5 1.5 0 0 0 1.5-1.5v-6a.5.5 0 0 0-1 0v6a.5.5 0 0 1-.5.5h-11a.5.5 0 0 1-.5-.5v-11a.5.5 0 0 1 .5-.5H9a.5.5 0 0 0 0-1H2.5A1.5 1.5 0 0 0 1 2.5z"/>
                                                </svg>
                                            </button> 
                                        </td>
                                        <td class="vaccinationTdShowtoMobile"><%= vaccinationSchedule.vaccine_name %></td>
                                        <td class="vaccinationTd">
                                            <% if (vaccinationSchedule.status === 'Taken')  {%>
                                            <p class="text-light bg-success text-center mb-0"> Taken </p>
                                            <%} else { %>
                                            <p class="text-danger mb-0"> Not Taken</p>
                                            <% } %></td>
                                        <td class="vaccinationTdShowtoMobile px-0">
                                            <form id="vaccinationForm">
                                                <input type="hidden" name="patientId" id="patientId" value="">
                                                <input type="hidden" name="scheduleId" id="scheduleId" value="">
                                                <input type="hidden" name="status" id="status" value="">
                                                <input type="hidden" name="vaccineName" id="vaccineName" value="">
                                                <input type="hidden" name="dateAdministered" id="dateAdministered" value="">
                                                <input type="hidden" name="gender" id="gender" value="">
                                                <input type="hidden" name="barangay" id="barangay" value="">
                                                <button type="button" class="btn btn-success py-0 fw-bold done-button"
                                                 data-patient-id="<%= vaccinationSchedule.patient_id %>"
                                                 data-schedule-id="<%= vaccinationSchedule.schedule_id %>"
                                                 data-vaccine-name="<%= vaccinationSchedule.vaccine_name %>"
                                                 data-gender="<%= vaccinationSchedule.gender %>"
                                                 data-barangay="<%= vaccinationSchedule.barangay %>"
                                                 data-schedule-date="<%= new Date().toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' }) %>"
                                                 data-status="Taken">
                                                 
                                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-shield-fill-check" viewBox="0 0 16 16">
                                                        <path fill-rule="evenodd" d="M8 0c-.69 0-1.843.265-2.928.56-1.11.3-2.229.655-2.887.87a1.54 1.54 0 0 0-1.044 1.262c-.596 4.477.787 7.795 2.465 9.99a11.8 11.8 0 0 0 2.517 2.453c.386.273.744.482 1.048.625.28.132.581.24.829.24s.548-.108.829-.24a7 7 0 0 0 1.048-.625 11.8 11.8 0 0 0 2.517-2.453c1.678-2.195 3.061-5.513 2.465-9.99a1.54 1.54 0 0 0-1.044-1.263 63 63 0 0 0-2.887-.87C9.843.266 8.69 0 8 0m2.146 5.146a.5.5 0 0 1 .708.708l-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 1 1 .708-.708L7.5 7.793z"/>
                                                    </svg> Mark as Taken
                                                </button>
                                            </form>
                                        </td>
                                    </tr>
                                    
                                    <% if (isLastScheduleForPatient) { %>
                                        <tr>
                                            <td colspan="6" class="text-light">.</td>
                                        </tr>
                                    <% } %>
                                <% }) %>
                            <% } else { %>
                                <tr>
                                    <td colspan="7" class="text-center text-light">No Schedules found</td>
                                </tr>
                            <% } %>
                        </tbody>
                        
                        
                        
                    </table>
                </div>
            </div>


            <!-- Update Vaccination Schedule Modal -->
<div class="modal fade" id="editScheduleModal" tabindex="-1" aria-labelledby="editScheduleModalLabel" aria-hidden="true">
  <div class="modal-dialog col-lg-4"> 
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title text-light" id="editScheduleModalLabel">Edit Vaccination Schedule</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body text-dark">
        <form id="editVaccinationSchedule">
          <input type="hidden" id="scheduleId" name="scheduleId">
          <div class="col-lg-12 col-sm-12 mb-3 input-container">
            <label class="text-light mb-1">Current Schedule Date</label>
            <input type="text" id="vaccinationSchedule" class="input mb-3" name="vaccinationSchedule" placeholder=" ">
          </div>
          <!-- Predefined Date Intervals -->
          <div class="mb-3">
            <label for="scheduleOptions" class="text-light mb-2">RESCHEDULE BY</label>
            <div class="form-check">
              <input class="form-check-input" type="radio" name="scheduleOptions" value="1" id="nextWeek">
              <label class="form-check-label text-light" for="nextWeek">
                Next Week
              </label>
            </div>
            <div class="form-check">
              <input class="form-check-input" type="radio" name="scheduleOptions" value="2" id="next2Weeks">
              <label class="form-check-label text-light" for="next2Weeks">
                Next 2 Weeks
              </label>
            </div>
            <div class="form-check">
              <input class="form-check-input" type="radio" name="scheduleOptions" value="3" id="next3Weeks">
              <label class="form-check-label text-light" for="next3Weeks">
                Next 3 Weeks
              </label>
            </div>
            <div class="form-check">
              <input class="form-check-input" type="radio" name="scheduleOptions" value="4" id="nextMonth">
              <label class="form-check-label text-light" for="nextMonth">
                Next Month
              </label>
            </div>
          </div>

          <div class="d-flex justify-content-end">
            <button type="submit" class="btn btn-success">Update</button>
            <button type="button" class="btn btn-danger ms-2" data-bs-dismiss="modal">Cancel</button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>




    </div> <!-- End of Main Content Column -->
</div> <!-- End of Row -->
</div> <!-- End of Main Container -->

        
<script>
  // Function to filter table based on search input
        function filterTable() {
            const searchInput = document.getElementById('searchInput').value.toLowerCase();
            const table = document.getElementById('vaccinationTable');
            const tr = table.getElementsByTagName('tr');

            for (let i = 1; i < tr.length; i++) {
                const tdFullName = tr[i].getElementsByTagName('td')[1]; // Full Name column
                if (tdFullName) {
                    const fullNameText = tdFullName.textContent || tdFullName.innerText;
                    if (fullNameText.toLowerCase().indexOf(searchInput) > -1) {
                        tr[i].style.display = ""; // Show row
                    } else {
                        tr[i].style.display = "none"; // Hide row
                    }
                }
            }
        }
</script>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
  <script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script src="/script.js"></script>
</body>
</html>