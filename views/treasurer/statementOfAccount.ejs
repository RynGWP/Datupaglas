<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>User Management</title>

  <!-- Google Font: Source Sans Pro -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400i,700&display=fallback">
  <!-- DataTables -->
  <link rel="stylesheet" href="/plugins/datatables-bs4/css/dataTables.bootstrap4.min.css">
  <link rel="stylesheet" href="/plugins/datatables-responsive/css/responsive.bootstrap4.min.css">
  <!-- <link rel="stylesheet" href="/plugins/datatables-buttons/css/buttons.bootstrap4.min.css"> -->
  <!-- Theme style -->
  <link rel="stylesheet" href="/dist/css/adminlte.min.css">
  <!-- SweetAlert2 -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
  <!-- Toastr -->
  <link rel="stylesheet" href="/plugins/toastr/toastr.min.css">
  <!-- BS Stepper -->
  <link rel="stylesheet" href="/plugins/bs-stepper/css/bs-stepper.min.css">
   <!-- daterange picker -->
   <link rel="stylesheet" href="/plugins/daterangepicker/daterangepicker.css">
     <!-- Tempusdominus Bootstrap 4 -->
  <link rel="stylesheet" href="/plugins/tempusdominus-bootstrap-4/css/tempusdominus-bootstrap-4.min.css">
<!-- Header styles -->
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700;900&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.1/css/all.min.css">
  <link rel="stylesheet" href="style2.css">
<style>

  .btn-primary.next, .btn-secondary.previous, .btn-success.finish {
    width: 100px;
    margin:5px;
  }


  p{
    margin-bottom: 0;
  }




  .text-success {
    color:rgb(14, 223, 14);
    font-weight: bold;
  }

  
.nav-icon {
  color:rgb(58, 59, 66);
}

p {
  color:rgb(119, 119, 134);
}


.nav-link.active{
  background-color: rgba(127, 127, 189, 0.338) !important;
}


.brand-link{
  border-bottom: none !important;
}

th{
  font-weight: 500 !important ;
  color:black; 
}

td{
  color:rgba(0, 0, 0, 0.596) !important;
}

</style>

</head>
<body class="hold-transition sidebar-mini layout-fixed">

     <!-- preloader -->
     <%- include('../partials/preloader.ejs') %>

  <div class="wrapper">
  
  
    <!-- Navbar -->
    <nav class="main-header navbar navbar-expand  navbar-light" >
      <!-- Left navbar links -->
      <ul class="navbar-nav">
        <li class="nav-item">
          <a class="nav-link text-light" data-widget="pushmenu" href="#" role="button"><i class="fas fa-bars"></i></a>
        </li>
        <!-- <li class="nav-item d-none d-sm-inline-block">
          <a href="index3.html" class="nav-link text-light">Home</a>
        </li>
        <li class="nav-item d-none d-sm-inline-block">
          <a href="#" class="nav-link">Contact</a>
        </li> -->
      </ul>
  
      <!-- Right navbar links -->
      <ul class="navbar-nav ml-auto">
        <!-- Navbar Search -->
        <!-- <button type="button" class="btn dropdown-toggle dropdown-icon text-light" data-toggle="dropdown" aria-expanded="false">
         Assessor <i class="fas fa-user"></i>
        </button> -->


         <%- include('../partials/profile.ejs') %>

         
      </ul>
    </nav>
    <!-- /.navbar -->
  
    <!-- Main Sidebar Container -->
    <aside class="main-sidebar sidebar-dark-primary elevation-4">
      <!-- Brand Logo -->
      <a href="index3.html" class="brand-link" 
      style="background-color: #ffffff;
      box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1);
    backdrop-filter: blur(4px) saturate(180%);
    -webkit-backdrop-filter: blur(2px) saturate(180%);
      ">
        <img src="/images/Seal_of_Datu_Paglas.png" alt="AdminLTE Logo" class="brand-image img-circle " style="opacity: .8">
        <small class="brand-text font-weight-bold text-dark"> DATU PAGLAS</small> 
      </a> 
  
      <!-- Sidebar -->
      <div class="sidebar" style="background-color: #ffffff;
      box-shadow: 0 4px 30px rgba(255, 255, 255, 0.1);
    backdrop-filter: blur(4px) saturate(180%);
    -webkit-backdrop-filter: blur(2px) saturate(180%);
      ">
        <!-- Sidebar user panel (optional) -->
     
  
  
  
        <!-- Sidebar Menu -->
        <nav class="mt-2">
          <ul class="nav nav-pills nav-sidebar flex-column" data-widget="treeview" role="menu" data-accordion="false">
            <!-- Add icons to the links using the .nav-icon class
                 with font-awesome or any other icon font library -->
                 <li class="nav-item " >
                  <a href="/TaxPayerDashboard" class="nav-link ">
                   
                   <i class="nav-icon"> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class=" bi bi-house" viewBox="0 0 16 16">
                    <path d="M8.707 1.5a1 1 0 0 0-1.414 0L.646 8.146a.5.5 0 0 0 .708.708L2 8.207V13.5A1.5 1.5 0 0 0 3.5 15h9a1.5 1.5 0 0 0 1.5-1.5V8.207l.646.647a.5.5 0 0 0 .708-.708L13 5.793V2.5a.5.5 0 0 0-.5-.5h-1a.5.5 0 0 0-.5.5v1.293zM13 7.207V13.5a.5.5 0 0 1-.5.5h-9a.5.5 0 0 1-.5-.5V7.207l5-5z"/>
                  </svg></i>
                    <p>
                      Dashboard   
                    </p>
                  </a>
                 
                <li class="nav-item">
                  <a href="/TaxPayerList" class="nav-link ">
                  
                  <i class="nav-icon">  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class=" bi bi-person-gear" viewBox="0 0 16 16">
                    <path d="M11 5a3 3 0 1 1-6 0 3 3 0 0 1 6 0M8 7a2 2 0 1 0 0-4 2 2 0 0 0 0 4m.256 7a4.5 4.5 0 0 1-.229-1.004H3c.001-.246.154-.986.832-1.664C4.484 10.68 5.711 10 8 10q.39 0 .74.025c.226-.341.496-.65.804-.918Q8.844 9.002 8 9c-5 0-6 3-6 4s1 1 1 1zm3.63-4.54c.18-.613 1.048-.613 1.229 0l.043.148a.64.64 0 0 0 .921.382l.136-.074c.561-.306 1.175.308.87.869l-.075.136a.64.64 0 0 0 .382.92l.149.045c.612.18.612 1.048 0 1.229l-.15.043a.64.64 0 0 0-.38.921l.074.136c.305.561-.309 1.175-.87.87l-.136-.075a.64.64 0 0 0-.92.382l-.045.149c-.18.612-1.048.612-1.229 0l-.043-.15a.64.64 0 0 0-.921-.38l-.136.074c-.561.305-1.175-.309-.87-.87l.075-.136a.64.64 0 0 0-.382-.92l-.148-.045c-.613-.18-.613-1.048 0-1.229l.148-.043a.64.64 0 0 0 .382-.921l-.074-.136c-.306-.561.308-1.175.869-.87l.136.075a.64.64 0 0 0 .92-.382zM14 12.5a1.5 1.5 0 1 0-3 0 1.5 1.5 0 0 0 3 0"/>
                  </svg></i>
                    <p>
                      User Management
                    </p>
                  </a>
                </li>
                <li class="nav-item">
                  <a href="/statementOfAccount" class="nav-link active">
                   
                  <i class="nav-icon">  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class=" bi bi-receipt-cutoff" viewBox="0 0 16 16">
                    <path d="M3 4.5a.5.5 0 0 1 .5-.5h6a.5.5 0 1 1 0 1h-6a.5.5 0 0 1-.5-.5m0 2a.5.5 0 0 1 .5-.5h6a.5.5 0 1 1 0 1h-6a.5.5 0 0 1-.5-.5m0 2a.5.5 0 0 1 .5-.5h6a.5.5 0 1 1 0 1h-6a.5.5 0 0 1-.5-.5m0 2a.5.5 0 0 1 .5-.5h6a.5.5 0 0 1 0 1h-6a.5.5 0 0 1-.5-.5m0 2a.5.5 0 0 1 .5-.5h6a.5.5 0 0 1 0 1h-6a.5.5 0 0 1-.5-.5M11.5 4a.5.5 0 0 0 0 1h1a.5.5 0 0 0 0-1zm0 2a.5.5 0 0 0 0 1h1a.5.5 0 0 0 0-1zm0 2a.5.5 0 0 0 0 1h1a.5.5 0 0 0 0-1zm0 2a.5.5 0 0 0 0 1h1a.5.5 0 0 0 0-1zm0 2a.5.5 0 0 0 0 1h1a.5.5 0 0 0 0-1z"/>
                    <path d="M2.354.646a.5.5 0 0 0-.801.13l-.5 1A.5.5 0 0 0 1 2v13H.5a.5.5 0 0 0 0 1h15a.5.5 0 0 0 0-1H15V2a.5.5 0 0 0-.053-.224l-.5-1a.5.5 0 0 0-.8-.13L13 1.293l-.646-.647a.5.5 0 0 0-.708 0L11 1.293l-.646-.647a.5.5 0 0 0-.708 0L9 1.293 8.354.646a.5.5 0 0 0-.708 0L7 1.293 6.354.646a.5.5 0 0 0-.708 0L5 1.293 4.354.646a.5.5 0 0 0-.708 0L3 1.293zm-.217 1.198.51.51a.5.5 0 0 0 .707 0L4 1.707l.646.647a.5.5 0 0 0 .708 0L6 1.707l.646.647a.5.5 0 0 0 .708 0L8 1.707l.646.647a.5.5 0 0 0 .708 0L10 1.707l.646.647a.5.5 0 0 0 .708 0L12 1.707l.646.647a.5.5 0 0 0 .708 0l.509-.51.137.274V15H2V2.118z"/>
                  </svg></i>
                    <p>
                      Statement Of Accounts
                    </p>
                  </a>
                </li>
                <li class="nav-item">
                  <a href="/paymentHistory" class="nav-link ">
                  
                   <i class="nav-icon"> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class=" bi bi-cash-coin" viewBox="0 0 16 16">
                    <path fill-rule="evenodd" d="M11 15a4 4 0 1 0 0-8 4 4 0 0 0 0 8m5-4a5 5 0 1 1-10 0 5 5 0 0 1 10 0"/>
                    <path d="M9.438 11.944c.047.596.518 1.06 1.363 1.116v.44h.375v-.443c.875-.061 1.386-.529 1.386-1.207 0-.618-.39-.936-1.09-1.1l-.296-.07v-1.2c.376.043.614.248.671.532h.658c-.047-.575-.54-1.024-1.329-1.073V8.5h-.375v.45c-.747.073-1.255.522-1.255 1.158 0 .562.378.92 1.007 1.066l.248.061v1.272c-.384-.058-.639-.27-.696-.563h-.668zm1.36-1.354c-.369-.085-.569-.26-.569-.522 0-.294.216-.514.572-.578v1.1zm.432.746c.449.104.655.272.655.569 0 .339-.257.571-.709.614v-1.195z"/>
                    <path d="M1 0a1 1 0 0 0-1 1v8a1 1 0 0 0 1 1h4.083q.088-.517.258-1H3a2 2 0 0 0-2-2V3a2 2 0 0 0 2-2h10a2 2 0 0 0 2 2v3.528c.38.34.717.728 1 1.154V1a1 1 0 0 0-1-1z"/>
                    <path d="M9.998 5.083 10 5a2 2 0 1 0-3.132 1.65 6 6 0 0 1 3.13-1.567"/>
                  </svg></i>
                    <p>
                      Payment History
                    </p>
                  </a>
                </li>
          </ul>
        </nav>
        <!-- /.sidebar-menu -->
      </div>
      <!-- /.sidebar -->
    </aside>
  
    <!-- Content Wrapper. Contains page content -->
    <div class="content-wrapper">
      <!-- Content Header (Page header) -->
      <div class="content-header">
        <div class="container-fluid">
          <div class="row mb-2">
            <div class="col-sm-6">
              <h1 class="m-0">Statement Of Accounts</h1>
            </div><!-- /.col -->
            <div class="col-sm-6">
              <ol class="breadcrumb float-sm-right">
                <!-- <li class="breadcrumb-item"><a href="#">Home</a></li>
                <li class="breadcrumb-item active">Dashboard v1</li> -->
              </ol>
            </div><!-- /.col -->
          </div><!-- /.row -->
        </div><!-- /.container-fluid -->
      </div>
      <!-- /.content-header -->

    <!-- Main content -->
    <section class="content">
      <div class="container-fluid">
        <div class="row">
          <div class="col-12">
           <div class="d-flex justify-content-end">
            <!-- <button type="button" class="btn text-primary  mb-3 " data-toggle="modal" data-target="#addModal" style="background:transparent; border: 1px solid blue;">
              Register              
              <i class="m-1 fa-solid fa-address-card"></i>
             </button> -->
           </div>
            <div class="card">
              <!-- <div class=" text-center h3 p-3">LIST OF TAX PAYERS</div> -->
              <div class="card-body">
                <table id="userManagementTable" class="table  ">
                  <thead>

                    
                    <tr>
                      <th>Full name</th>
                      <th>Assessment level</th>
                      <th>Assessed value</th>
                      <th>Property type</th>
                      <th>Tax rate</th>
                      <th>Total tax amount</th>
                      <th>Due date</th>
                      <th>Payment Status</th>
                      <th>Action</th>
                    </tr>
                  </thead>
                  
                  <tbody>
                      <% if(locals.statementOfAccounts) { %>
                        <% statementOfAccounts.forEach(function(statementOfAccount) { %>

                      <tr>
                        <td><%= statementOfAccount.firstname%> <%= statementOfAccount.lastname%></td>
                        <td><%= statementOfAccount.assessment_level%></td>
                        <td><%= statementOfAccount.assessed_value%></td>         
                        <td><%= statementOfAccount.property_type%></td>
                        <td><%= statementOfAccount.tax_rate%></td>         
                        <td class="text-info"><%= statementOfAccount.total_tax_amount%></td>   
                        <td class="text-danger"><%= new Date(statementOfAccount.due_date).toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' }) %></td>       
                        <td><span class="badge badge-<%= statementOfAccount.status ==='pending' ? 'warning' : 'success' %>"> <%= statementOfAccount.status %></span></td>
                        <td>
                          <div class="d-none d-flex justify-content-center" style="gap:3px">
                            

                            <!-- payment Button -->
                     
                      <button type="button" class="btn btn-primary btn-sm d-flex justify-content-center align-items-center paymentButton" data-toggle="modal" data-target="#Modal"
                        data-taxpayer_statement_id="<%= statementOfAccount.id %>"
                        data-taxpayer_id="<%= statementOfAccount.taxpayer_id %>"                       
                        data-taxpayer_fname="<%= statementOfAccount.firstname %>"
                        data-taxpayer_lname="<%= statementOfAccount.lastname %> "
                        data-taxpayer_total_tax_amount="<%= statementOfAccount.total_tax_amount %> ">
                      <i class="fa-solid fa-money-check-dollar"></i>
                      </button>
                  
                          
                         
                      </td>
                      <!-- /Action -->
                    </tr>

                    <% }) %>
                    <% } %>
                 
                  </tbody>
                </table>
              </div>
              <!-- /.card-body -->
            </div>
            <!-- /.card -->
          </div>
          <!-- /.col -->
        </div>
        <!-- /.row -->
      </div>
      <!-- /.container-fluid -->
    </section>
    <!-- /.content -->
  </div>
  <!-- /.content-wrapper -->
  <footer class="main-footer">
    <div class="float-right d-none d-sm-block">
      <b>Version</b> 3.2.0
    </div>
    <strong>Copyright &copy; 2014-2021 <a href="https://adminlte.io">AdminLTE.io</a>.</strong> All rights reserved.
  </footer>

  <!-- Control Sidebar -->
  <aside class="control-sidebar control-sidebar-dark">
    <!-- Control sidebar content goes here -->
  </aside>
  <!-- /.control-sidebar -->
</div>
<!-- ./wrapper -->


<!-- modal for payment -->
<div class="modal fade" id="Modal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-md">
    <div class="modal-content shadow-lg">
      <div class="modal-header" style="background-color: rgba(2, 2, 40, 0.792);
      box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1);
      backdrop-filter: blur(4px) saturate(180%);
      -webkit-backdrop-filter: blur(2px) saturate(180%);
      border: 1px solid rgba(94, 103, 146, 0.3);
      color:rgb(87, 191, 228)">
        <h4 class="modal-title">Add Payment</h4>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>

      <div class="modal-body p-4 " style="background-color:rgba(2, 2, 40, 0.792);
      box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1);
      backdrop-filter: blur(4px) saturate(180%);
      -webkit-backdrop-filter: blur(2px) saturate(180%);
      border: 1px solid rgba(94, 103, 146, 0.3);">
       <form id="paymentForm" action="/insertPayment" method="post">
              <input type="hidden" id="statement_id" name="id">
              <input type="hidden" id="fname" name="firstname">
              <input type="hidden" id="lname" name="lastname">
              <input type="hidden" name="taxpayer_id" id="taxpayer_id">
              <input type="hidden" id="totalTaxAmount" class="form-control" name="total_tax_amount">
              <input type="hidden" value="paid" name="status">
            <div class="row">
              <div class="col-lg-12">
                <label for="marketValue" class="form-label text-light">Total Tax Amount</label>
                <p class="form-control mb-3" id="totalTaxAmountText" style=" color:#00ff00;font-weight: bold ; background-color: black; border:none !important "></p>
              </div>
            </div>

            <div class="row">
              <div class="col-lg-12">
                <label for="marketValue" class="form-label text-light">Cash Tendered</label>
                <input type="number" id="cashTendered" placeholder="Enter Amount" class="form-control mb-3" required name="cash_tendered" style="background-color: black; color:white; border:none !important">
              </div>
            </div>

            <div class="row">
              <div class="col-lg-12">
                <label for="marketValue" class="form-label text-light">Change</label>
                <input type="number" id="change" class="form-control mb-3" required name="change"  style=" color:#6ba6da; font-weight: bold; background-color: black; border:none !important">
              </div>
            </div>
          
          </div>

          <div class="modal-footer justify-content-between " style="background: rgb(2, 2, 40, 0.792) ;
          box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1);
          backdrop-filter: blur(4px) saturate(180%);
          -webkit-backdrop-filter: blur(2px) saturate(180%);
          border: 1px solid rgba(94, 103, 146, 0.3);">
            <p class="text-light">Insert To: <strong><span id="fnameText"></span> <span id="lnameText"></span></strong></p>
            <button type="submit" id="submitPayment" class="btn btn-success">Insert Payment</button>
          </div>
        </form>
   </div>
  </div>
</div>


<script src="/plugins/jquery/jquery.min.js"></script>
<script src="/plugins/bootstrap/js/bootstrap.bundle.min.js"></script>
<script src="/plugins/datatables/jquery.dataTables.min.js"></script>
<script src="/plugins/datatables-bs4/js/dataTables.bootstrap4.min.js"></script>
<script src="/plugins/datatables-responsive/js/dataTables.responsive.min.js"></script>
<script src="/plugins/datatables-responsive/js/responsive.bootstrap4.min.js"></script>
 <script src="/plugins/datatables-buttons/js/dataTables.buttons.min.js"></script>
<script src="/plugins/datatables-buttons/js/buttons.bootstrap4.min.js"></script> 
<script src="/plugins/jszip/jszip.min.js"></script>
<script src="/plugins/pdfmake/pdfmake.min.js"></script>
<script src="/plugins/pdfmake/vfs_fonts.js"></script>
<script src="/plugins/datatables-buttons/js/buttons.html5.min.js"></script>
<script src="/plugins/datatables-buttons/js/buttons.print.min.js"></script> 
<script src="/plugins/datatables-buttons/js/buttons.colVis.min.js"></script>
<script src="/dist/js/adminlte.min.js"></script>
<script src="/plugins/bs-stepper/js/bs-stepper.min.js"></script>
<!-- <script src="/plugins/dropzone/min/dropzone.min.js"></script> -->
<script src="/plugins/moment/moment.min.js"></script>
<!-- Tempusdominus Bootstrap 4 -->
<script src="/plugins/tempusdominus-bootstrap-4/js/tempusdominus-bootstrap-4.min.js"></script>

<!-- Toastr -->
<script src="/plugins/toastr/toastr.min.js"></script>

<script>
  $(function () {
    $("#userManagementTable").DataTable({
       "lengthChange": true,
       "autoWidth": false,  
       "searching": true,
       "ordering": false,
      });
    });

</script>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const editButtons = document.querySelectorAll('.paymentButton');
  
    editButtons.forEach(button => {
      button.addEventListener('click', () => {
        const taxpayer_id = button.dataset.taxpayer_id;
        const statement_id = button.dataset.taxpayer_statement_id;
        const taxpayer_fname = button.dataset.taxpayer_fname;
        const taxpayer_lname = button.dataset.taxpayer_lname;
        const totalTaxAmount = button.dataset.taxpayer_total_tax_amount;
       
  
        document.getElementById('statement_id').value = statement_id;
        document.getElementById('taxpayer_id').value = taxpayer_id;
        document.getElementById('fname').value = taxpayer_fname;
        document.getElementById('lname').value = taxpayer_lname;
        document.getElementById('totalTaxAmount').value = totalTaxAmount;
        document.getElementById('totalTaxAmountText').textContent = totalTaxAmount;
        document.getElementById('fnameText').textContent = taxpayer_fname;
        document.getElementById('lnameText').textContent = taxpayer_lname;


      });
    });
  });


  
</script>

<script>
  const taxElement = document.getElementById('totalTaxAmount');
  const cashTenderedInput = document.getElementById('cashTendered');
  const change = document.getElementById('change');

  // Function to update the remaining balance
  function updateRemainingBalance() {
      const tax = parseFloat(taxElement.value) || 0; // Convert to number, default to 0
      const cashTendered = parseFloat(cashTenderedInput.value) || 0; // Convert to number, default to 0
      const changeValue = cashTendered - tax;

      // Update the text content of the remaining balance
      if (cashTendered < tax ) {
        change.value = '';
      } else {
      change.value = changeValue.toFixed(2); // 2 decimal places
      }

  }

  // Listen for input changes in the cash tendered field
  cashTenderedInput.addEventListener('input', updateRemainingBalance);
</script>


<script>
  const submitPayment = document.querySelector('#submitPayment');
  const paymentForm = document.querySelector('#paymentForm'); // Select the form element

  submitPayment.addEventListener('click', function (event) {
      event.preventDefault(); // Prevent default form submission

      Swal.fire({
          title: 'Are you sure?',
          text: "You want to insert this payment ?",
          icon: 'warning',
          showCancelButton: true,
          confirmButtonText: "Yes",
          confirmButtonColor: "#12be12c1",
          cancelButtonText: "Cancel",
          cancelButtonColor: "#FF0000",
          customClass: {
              popup: 'glassmorphism-popup'
          }
      }).then((result) => {
          if (result.isConfirmed) {
              // Submit the form if confirmed
              paymentForm.submit();
          }
      });
  });
</script>


<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"> </script>

<script src="/userManagementScript.js"></script>
<script src="/preloader.js"></script>
</body>
</html>
